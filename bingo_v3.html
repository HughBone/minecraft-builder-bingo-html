<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bingo Generator</title>
<style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; background: lime; }
    #grid { display: grid; gap: 5px; margin-top: 15px; }
    .cell {
        border: 1px solid #333;
        padding: 12px;
        text-align: center;
        cursor: pointer;
        user-select: none;
        border-radius: 6px;
        transition: background 0.2s, color 0.2s;
        background: white;
    }
    .cell.highlighted {
        background: #ffff99;
        color: #000;
    }
    .cell.done {
        background: #bcbcbc;
        color: #444;
        text-decoration: line-through;
    }
</style>
</head>

<body>

<h2>Bingo Card Generator</h2>
<label>Card Size:</label>
<input type="number" id="size" min="1" value="3" style="width:60px" />
<br><br>

<label>Seed:</label>
<input type="text" id="seed" style="width:200px" placeholder="Seed will be generated" />
<span id="seedDisplay" style="margin-left:10px; font-weight:bold;"></span>
<br><br>

<label>Entries (one per line):</label><br>
<textarea id="entries" rows="7" style="width:100%">
add a [simple]
use [weird block]
use [functional block]
add some kind of [idea]
add [X] upside-down stairs
add [X] open fence gates
use one of every [wood]-type block
use [Y] unique redstone components
use [color] glazed terracotta
use [wood] shelves
use [stone]
use [wood] and [weird block]
build must be [theme]
build must have at least [Z] moving parts
build must use [stone] and have [idea]
add [X] trapdoors
add [Y] light sources
use exactly [Z] [functional block]
add a [simple] made out of [stone]
</textarea>
<br><br>

<button id="generate">Generate New Card</button>
<button id="applySeed">Apply Seed</button>
<div id="grid"></div>

<script>
    // Seeded random number generator (mulberry32)
    function seededRandom(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        };
    }

    // String hash function for converting text seeds to numbers
    function hashString(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return hash;
    }

    let random = Math.random; // Default to Math.random

    function getData() {
        return {
            ["stone"]: [
                "stone",
                "cobblestone",
                "blackstone",
                "deepslate",
                "granite",
                "diorite",
                "andesite",
            ],
            ["wood"]: [
                "oak",
                "birch",
                "spruce",
                "jungle",
                "acacia",
                "dark oak",
                "cherry",
                "crimson",
                "warped",
                "bamboo",
                "pale oak",
                "mangrove",
            ],
            ["theme"]: [
                "cyberpunk",
                "medieval",
                "fantasy",
                "post-apocalyptic",
                "organic",
                "creepy",
                "tall",
                "wide",
                "steampunk",
                "cold",
                "hot",
            ],
            ["color"]: [
                "white",
                "light gray",
                "gray",
                "black",
                "brown",
                "red",
                "orange",
                "yellow",
                "lime",
                "green",
                "cyan",
                "light blue",
                "blue",
                "purple",
                "magenta",
                "pink",
            ],
            ["weird block"]: [
                "amethyst block",
                "wet sponge",
                "enchanting table",
                "bell",
                "vault",
                "display entity",
                "melon stem",
                "TNT",
                "diamond block",
                "netherite block",
                "purpur pillar",
            ],
            ["functional block"]: [
                "fletching table",
                "composter",
                "jukebox",
                "smoker",
                "furnace",
                "blast furnace",
                "cartography table",
                "stonecutter",
                "grindstone",
                "crafting table",
                "smithing table",
                "anvil",
            ],
            ["idea"]: [
                "bridge",
                "tower",
                "garden",
                "gate",
                "machine",
                "circle",
                "square",
                "triangle",
                "house",
                "vehicle",
                "mountain",
                "face",
                "animal",
                "pillar",
            ],
            ["simple"]: [
                "bush",
                "tree",
                "rock",
                "door",
                "farm",
            ],
        }
    }

    let data = getData();
    const sizeInput = document.getElementById("size");
    const seedInput = document.getElementById("seed");
    const seedDisplay = document.getElementById("seedDisplay");
    const entriesInput = document.getElementById("entries");
    const grid = document.getElementById("grid");

    let noEntryRepeats = new Set(); // Set<string>
    
    function generateRandomSeed() {
        return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    }
    
    function generateCard(seedValue) {
        noEntryRepeats = new Set();
        data = getData();

        seedDisplay.textContent = `Current seed: ${seedValue}`;
        seedInput.value = seedValue;
        
        const numericSeed = hashString(seedValue);
        random = seededRandom(numericSeed);

        const size = parseInt(sizeInput.value) || 3;
        let entries = shuffle(
            entriesInput.value
                .split("\n")
                .map(x => x.trim())
                .filter(Boolean)
        );

        // Adjust entries list to match size^2
        const needed = size * size;
        if (entries.length < needed) {
            // Repeat entries if too few
            while (entries.length < needed) {
                entries.push(randomItem(entries));
            }
        } else if (entries.length > needed) {
            entries = entries.slice(0, needed);
        }

        entries = entries.map((entry) => {
            let newEntry = entry;
            while (true) {
                for (let i=0; i<entries.length * 2; i++) {
                    if (noEntryRepeats.has(entry)) {
                        newEntry = randomItem(entries);
                        continue;
                    }

                    noEntryRepeats.add(entry);
                    return replaceStringWithToken(newEntry);
                }
                // Reset repeats as a last resort
                noEntryRepeats = new Set();
            }
        });

        // Click entry to gray it out
        grid.innerHTML = "";
        grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
        entries.forEach(text => {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.textContent = text;
            cell.addEventListener("click", () => {
                if (!cell.classList.contains("highlighted") && !cell.classList.contains("done")) {
                    // First click: highlight
                    cell.classList.add("highlighted");
                } else if (cell.classList.contains("highlighted")) {
                    // Second click: gray out
                    cell.classList.remove("highlighted");
                    cell.classList.add("done");
                } else if (cell.classList.contains("done")) {
                    // Third click: reset
                    cell.classList.remove("done");
                }
            });
            grid.appendChild(cell);
        });
    }
    
    // Generate button always creates a new random seed
    document.getElementById("generate").addEventListener("click", () => {
        const seedValue = generateRandomSeed();
        generateCard(seedValue);
    });
    
    // Apply Seed button uses the seed from the input field
    document.getElementById("applySeed").addEventListener("click", () => {
        const seedValue = seedInput.value.trim();
        if (!seedValue) {
            alert("Please enter a seed first!");
            return;
        }
        generateCard(seedValue);
    });

    document.addEventListener("DOMContentLoaded", function() {
      const button = document.getElementById("generate");
      button.click();
    });

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function randomItem(array) {
        return array[Math.floor(random() * array.length)];
    }

    function randomBetween(min, max) {
        return Math.floor(random() * (max - min + 1)) + min;
    }

    function replaceStringWithToken(str) {
        const newStr = str.replace(/\[(.+?)\]/g, (_, token) => {
            if (token === "X") {
                return randomBetween(1, 50);
            } else if (token === "Y") {
                return randomBetween(1, 8);
            } else if (token === "Z") {
                return randomBetween(1, 4);
            }

            let tokenList = data[token];
            if (!tokenList) return `<INVALID: '${token}'>`;

            // Refresh token data when we run out
            if (!tokenList.length) {
                data[token] = getData()[token];
                tokenList = data[token];
            }

            const candidate = randomItem(tokenList);
            data[token] = tokenList.filter(x => x !== candidate);
            return candidate;
        });

        return newStr;
    }
</script>

</body>
</html>
